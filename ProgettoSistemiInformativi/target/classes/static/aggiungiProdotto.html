<!DOCTYPE html>
<html>
<head>
  <title>Inserisci Prodotto</title>
  <!-- Stili CSS e script JavaScript necessari -->
</head>
<body>
<h1>Inserisci Prodotto</h1>
<form id="productForm" onsubmit="submitProduct(event)">
  <!-- Campi per i dati del nuovo prodotto -->
  <div>
    <label for="codiceBarre">Codice a Barre:</label>
    <input type="text" id="codiceBarre" name="codiceBarre" required>
  </div>
  <div>
    <label for="prezzo">Prezzo:</label>
    <input type="number" id="prezzo" name="prezzo" required>
  </div>
  <div>
    <label for="quantita">Quantita':</label>
    <input type="number" id="quantita" name="quantita" required>
  </div>
  <div>
    <button type="submit" onclick="confirmSaveProduct(event)">Salva</button>
    <button class="button" onclick="goBack()">Torna Indietro</button>
  </div>
</form>

<script>
  function submitProduct(event) {
    event.preventDefault();
    // Recupera i dati del nuovo prodotto dal form
    var codiceBarre = document.getElementById('codiceBarre').value;
    var prezzo = document.getElementById('prezzo').value;
    var quantita = document.getElementById('quantita').value;

    // Crea un oggetto con i dati del nuovo prodotto
    var newProduct = {
      codiceBarre: codiceBarre,
      prezzo: prezzo,
      quantita: quantita
    };

    // Invia i dati del nuovo prodotto al server
    const urlParams = new URLSearchParams(window.location.search);
    var badgeCode = urlParams.get('badgeCode');
    var url = `/inserisciProdotto?badgeCode=${badgeCode}`;
    fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(newProduct)
    })
    .then(response => {
      if (response.ok) {
        if (confirm('Prodotto inserito con successo. Vuoi tornare all\'elenco dei prodotti?')) {
          var badgeCode = getBadgeCodeFromURL();
          var url = 'elencoProdotti.html?badgeCode=' + badgeCode;
          window.location.href = url;
        } else {
          // L'utente ha premuto "Annulla", rimani sulla pagina corrente
        }
      } else {
        console.error('Errore durante l\'inserimento del prodotto');
      }
    });
  }

  function getBadgeCodeFromURL() {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get('badgeCode');
  }

  function goBack() {
    history.back();
  }

  function confirmSaveProduct(event) {
    event.preventDefault();
    if (confirm('Vuoi salvare il prodotto?')) {
      submitProduct(event);
    }
  }
</script>
</body>
</html>
